name: RDP

on: [workflow_dispatch]

jobs:
  build:
    runs-on: windows-latest

    steps:
      - name: ğŸ§² ØªÙ†Ø²ÙŠÙ„ ngrok
        shell: powershell
        run: |
          Invoke-WebRequest "https://bin.equinox.io/c/bNyj1mQVY4c/ngrok-stable-windows-amd64.zip" -OutFile ngrok.zip
          Expand-Archive -Path ngrok.zip -DestinationPath .
          Get-ChildItem -Recurse -Filter "ngrok.exe"

      - name: ğŸ” ØªØ¹ÙŠÙŠÙ† Ø±Ù…Ø² Ù…ØµØ§Ø¯Ù‚Ø© ngrok
        shell: powershell
        run: |
          $ngrokPath = Get-ChildItem -Recurse -Filter "ngrok.exe" | Select-Object -First 1 -ExpandProperty FullName
          if (-not $ngrokPath) {
            Write-Error "âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ngrok.exe"
            exit 1
          }
          & $ngrokPath authtoken "Ø¶Ø¹_Ø§Ù„ØªÙˆÙƒÙ†_Ø§Ù„Ø®Ø§Øµ_Ø¨Ùƒ_Ù‡Ù†Ø§"

      - name: ğŸ–¥ï¸ ØªÙØ¹ÙŠÙ„ RDP (Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ§Ù„Ù…Ø³Ø¤ÙˆÙ„)
        shell: powershell
        run: |
          net user kamel123 MyStrong123 /add
          net localgroup administrators kamel123 /add
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -Name 'fDenyTSConnections' -Value 0
          Enable-NetFirewallRule -DisplayGroup "Remote Desktop"

      - name: ğŸš€ ØªØ´ØºÙŠÙ„ ngrok TCP 3389 ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©
        shell: powershell
        run: |
          $ngrokPath = Get-ChildItem -Recurse -Filter "ngrok.exe" | Select-Object -First 1 -ExpandProperty FullName
          if (-not $ngrokPath) {
            Write-Error "âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ngrok.exe Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ù†ÙÙ‚"
            exit 1
          }

          $log = "$Env:RUNNER_TEMP\ngrok.log"
          Start-Process -FilePath $ngrokPath -ArgumentList "tcp 3389" -RedirectStandardOutput $log -RedirectStandardError $log -NoNewWindow
          Start-Sleep -Seconds 8

          if (Test-Path $log) {
            Write-Output "ğŸ“„ Ø³Ø¬Ù„ ngrok:"
            Get-Content $log -Tail 100
          } else {
            Write-Output "âš ï¸ Ù„Ù… ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø³Ø¬Ù„ ngrok Ø¨Ø¹Ø¯."
          }

          # Ø¥Ø¨Ù‚Ø§Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø© ÙØ¹Ø§Ù„Ø© Ù„Ø¨Ø¹Ø¶ Ø§Ù„ÙˆÙ‚Øª (2 Ø¯Ù‚Ø§Ø¦Ù‚ ØªÙ‚Ø±ÙŠØ¨Ø§Ù‹)
          Write-Output "â³ Ø¥Ø¨Ù‚Ø§Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø© ÙØ¹Ø§Ù„Ø© Ù„Ù…Ø¯Ø© 120 Ø«Ø§Ù†ÙŠØ©..."
          Start-Sleep -Seconds 120

      - name: âœ… Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ù‡Ù…Ø©
        shell: powershell
        run: Write-Output "ğŸ‰ Ø§Ù„Ù…Ù‡Ù…Ø© Ø§ÙƒØªÙ…Ù„Øª Ø¨Ù†Ø¬Ø§Ø­!"
